# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```


## Архитектура приложения

![Image alt](https://github.com/Camteer/web-larek-frontend/raw/main/Диаграмма.png)

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.


```constructor(baseUrl: string, options: RequestInit = {}) ``` - создает новый экземпляр класса, используя базовую ссылку и параметрами запроса.


Методы: 

- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  


```constructor() ``` - создает новый экземпляр класса.

Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

- `on` - подписка на событие
- `off` - отписка от события   
- `emit` - инициализация события
- `onAll` - подписка на все события
- `offAll` - отписка на все события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

#### Класс Component

Класс является дженериком и родителем всех компонентов слоя представления. В дженерик принимает тип объекта, в котором данные будут передаваться в метод render для отображения данных в компоненте. В конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента. Содержит метод render, отвечающий за сохранение полученных в параметре данных в полях компонентов через их сеттеры, возвращает обновленный контейнер компонента.

```constructor(container: HTMLElement) ``` - создает новый экземпляр класса, используеет переданный контейнер для работы с ним (заполнение, удаление, изменение данных внутри контейнера).

Методы: 
- `toggleClass` - переключить класс
- `setText` - установить текстовое содержимое
- `setDisabled` - сменить статус блокировки
- `setHidden` - скрыть элемент
- `setVisible` - показать элемент класс
- `setImage` - установить изображение с алтернативным текстом
- `render` - вернуть корневой элемент

#### Класс Model

Класс является дженериком и родителем всех компонентов слоя данных (Товаров и окружения приложения). Класс используется всеми классами из слоя данных.

```constructor(data: Partial<T>, protected events: IEvents)``` - создание экзмпляра класса Model, принимает данные и объект событий.

Методы: 
- `emitChanges` - Сообщает, что модель поменялась

### Слой данных

#### Класс ProductItem

Класс отвечает за хранение и логику работы с данными. Класс позволяет создавать новые продукты по полученным данным. Класс наследуется от Model

В полях класса хранятся следующие данные:

- `id: string` - Уникальный идентификатор продукта.
- `description: string` - Описание продукта.
- `image: string` - Ссылка на изображение продукта.
- `title: string` - Наименование продукта.
- `category: Category` - Категория, к которой относится продукт.
- `price: number` - Цена продукта.

#### Класс AppData

Класс является представлением всего состояния приложения. Класс наследуется от Model. 

В полях класса хранятся следующие данные:

- `basket: string[]` - массив id товаров в корзине.
- `catalog IItem[]` - массив товаров в каталоге
- `order: IOrder;` - объект, описывающий данные пользователя о заказе
- `preview: string | null;` - id товара, открытый в данный момент.
- `formErrors: FormErrors` - объект ошибок в форме заказа.

Методы: 

- `toggleOrderedProduct (id: string, isIncluded: boolean)` - метод добавления или удаления товара
- `clearBasket ()` - метод для очистки корзины
- `getTotal ()` - метод для подсчета стоимости товара
- `setCatalog ()` - метод для установки товара по подели ProductItem
- `setPreview ()` - метод для установки открытого товара
- `validateOrder () ` - метод валидации форм


### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Card 

Класс Card предназначен для вывода информации о продукте (название, изображение, описание, цена, категория). Наследует класс Component и реализует интерфейс ICard.

В полях класса хранятся следующие данные:

- `_title: HTMLElement;` - заголовок продукта
- `_image: HTMLElement;` - изображение продукта
- `_description: HTMLElement;` - описание продукта
- `_category: HTMLElement;` - категория продукта
- `_price: HTMLElement;` - цена продукта
- `_button: HTMLButtonElement` - кнопка карточки

Методы: 

- `title ()` - устанавливает заголовок
- `image ()` - устанавливает изображение 
- `description: ()` - устанавливает описание
- `category ()` - устанавливает категорию
- `price () ` - устанавливает цену

#### Класс Page 

Класс Page предназначен для вывода информации на старницe. Наследует класс Component и реализует интерфейс IPage.

В полях класса хранятся следующие данные:

- `_counter: HTMLElement;` - счетчик товаров в корзине
- `_catalog: HTMLElement;` - каталог товаров
- `_wrapper: HTMLElement;` - обертка страницы
- `_basket: HTMLElement;` - корзина с товарами


Методы: 

- `counter (value: number) ` - считает количество элементов в корзине
- `catalog (items: HTMLElement[]) ` - устанавливает список элементов на странице
- `locked (value: boolean)` - блокирует прокрутку


#### Класс Modal 

Класс Modal предназначен для открытия и закрытия модальньного окна. Наследует класс Component и реализует интерфейс IModal.

В полях класса хранятся следующие данные:

- `_closeButton: HTMLButtonElement;` - кнопка закрытия модального окна
- `_content: HTMLElement;` - элемент отображения в модальном окне

Методы: 

- `content(items: HTMLElement[]) ` - установить контент в моадльном окне
- `open ()` - открыть модальное окно
- `close ()` - закрыть модальное окно
- `render (data)` - формирует модальное окно при открытие

#### Класс Basket 

Класс Basket предназначен для хранения выбранных элементов в корзине. Наследует класс Component и реализует интерфейс IBasket.

В полях класса хранятся следующие данные:

- `_list: HTMLElement;` - элемент списка выбранных товаров
- `_total: HTMLElement` - общая стоимость товаров
- `_button: HTMLElement;` - кнопка оформления заказа

Методы: 

- `items (items: HTMLElement[])` - установить список товаров в корзине
- `total (total: number)` - устанавливает общую стоимость заказа

#### Класс Form 

Класс Form является дженериком, его обобщённый тип принимает конкретное значение при реализации его дочерних классов, предназначен отображения формы, устанавливает верную валидацию формы. Наследует класс Component и реализует интерфейс IForm.

В полях класса хранятся следующие данные:

- `_submit: HTMLButtonElement` - кнопка отправки формы
- `_errors: HTMLElement;` - элементы ошибки валидации


Методы: 

- `onInputChange(field, value: string)` - отпрвка изменений данных в форме
- `valid (value: boolean)` - установка доступа к кнопке
- `errors (value: string)` - установка текста ошибки валидации
- `render (state: IFormState)` - рендер формы с переданными значениями

#### Класс OrderAdress 

Класс OrederAdress предназначен отображения формы, устанавливает верную валидацию формы об адрессе пользователя и способа оплаты. Наследует класс Form и реализует интерфейс IOrderAdress.

Методы: 

- `adress (value: string)` - установка адреса
- `payment(value: string)` - установка способа оплаты


#### Класс OrderData 

Класс OrderData предназначен отображения формы, устанавливает верную валидацию формы об телефоне и почте пользователя. Наследует класс Form и реализует интерфейс IOrderData.

Методы: 

- `phone (value: string)` - установка телефона
- `email (value: string)` - установка емаила

#### Класс Success 

Класс Success предназначен отображения формы при удачном выполнении заказа. Наследует класс Component и реализует интерфейс ISuccess.

В полях класса хранятся следующие данные:

- `_close: HTMLButtonElement` - кнопка закрытия окна

### Слой коммуникации

#### Класс LarekApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

### События 

#### Modal

- `modal:open` - открытие модального окна
- `modal:close` - закрытие модального окна

#### Basket 

- `basket:changed` - изменение корзины
- `counter:changed` - изменения количества товаров в корзине
- `basket:open` - открытие модального окна корзины

#### Form 

- `order:open` - открытие модального окна доставки
- `payment:toggle` - изменение способа оплаты
- `/^order\..*:change/` - изменение поля формы доставки
- `order:submit` - отправка формы доставки
- `contacts:submit` - отправка формы контактов
- `formErrors:change` - списки ошибок

#### Card

- `items:changed` - изменения каталога 
- `card:add` - добавление карточки
- `card:remote` - удаление карточки
- `card:select` - выбор карточки

